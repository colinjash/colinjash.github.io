<!DOCTYPE html>
<html>
<head>
    <title>Baseball Player Similarity</title>
    <style>
        body { font-family: Arial; }
        .comparison { display: flex; justify-content: space-around; }
        table { border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; }
    </style>
</head>
<body>
    <h1>Find Similar Baseball Players</h1>
    <input type="text" id="playerName" placeholder="Enter player name">
    <input type="number" id="season" placeholder="Enter season (2008-2025)">
    <button onclick="findSimilar()">Find Similar Player</button>
    <div id="result"></div>

    <script>
        // Load CSV (you can host stats.csv on GitHub or parse it client-side)
        async function loadCSV() {
            const response = await fetch('stats.csv');
            const text = await response.text();
            return text.split('\n').map(line => line.split(','));
        }

        function calculateSimilarity(p1, p2) {
            const avgDiff = p1.avg_plus - p2.avg_plus;
            const obpDiff = p1.obp_plus - p2.obp_plus;
            const slgDiff = p1.slg_plus - p2.slg_plus;
            return Math.sqrt(avgDiff * avgDiff + obpDiff * obpDiff + slgDiff * slgDiff);
        }

        async function findSimilar() {
            const name = document.getElementById('playerName').value.trim();
            const season = parseInt(document.getElementById('season').value);
            if (!name || season < 2008 || season > 2025) {
                document.getElementById('result').innerHTML = 'Invalid input';
                return;
            }

            const data = await loadCSV();
            const players = data.slice(1).map(row => ({
                name: row[9].replace(/"/g, ''),
                season: parseInt(row[0]),
                team: row[1].replace(/"/g, ''),
                pos: row[2].replace(/"/g, ''),
                wrc_plus: parseFloat(row[3]),
                avg_plus: parseFloat(row[4]),
                obp_plus: parseFloat(row[5]),
                slg_plus: parseFloat(row[6]),
                hr: parseInt(row[7]),
                pa: parseInt(row[8])
            }));

            const inputPlayer = players.find(p => p.name.toLowerCase() === name.toLowerCase() && p.season === season);
            if (!inputPlayer) {
                document.getElementById('result').innerHTML = 'Player not found';
                return;
            }

            const similarPlayers = players.filter(p => p.pos === inputPlayer.pos &&
                p.name !== inputPlayer.name &&
                Math.abs(p.wrc_plus - inputPlayer.wrc_plus) <= 15);

            let mostSimilar = null, minDistance = Infinity;
            for (const p of similarPlayers) {
                const distance = calculateSimilarity(inputPlayer, p);
                if (distance < minDistance) {
                    minDistance = distance;
                    mostSimilar = p;
                }
            }

            if (mostSimilar) {
                document.getElementById('result').innerHTML = `
                    <div class="comparison">
                        <table>
                            <tr><th>Metric</th><th>${inputPlayer.name}</th><th>${mostSimilar.name}</th></tr>
                            <tr><td>Season</td><td>${inputPlayer.season}</td><td>${mostSimilar.season}</td></tr>
                            <tr><td>Team</td><td>${inputPlayer.team}</td><td>${mostSimilar.team}</td></tr>
                            <tr><td>Position</td><td>${inputPlayer.pos}</td><td>${mostSimilar.pos}</td></tr>
                            <tr><td>wRC+</td><td>${inputPlayer.wrc_plus.toFixed(2)}</td><td>${mostSimilar.wrc_plus.toFixed(2)}</td></tr>
                            <tr><td>AVG%+</td><td>${inputPlayer.avg_plus.toFixed(2)}</td><td>${mostSimilar.avg_plus.toFixed(2)}</td></tr>
                            <tr><td>OBP%+</td><td>${inputPlayer.obp_plus.toFixed(2)}</td><td>${mostSimilar.obp_plus.toFixed(2)}</td></tr>
                            <tr><td>SLG%+</td><td>${inputPlayer.slg_plus.toFixed(2)}</td><td>${mostSimilar.slg_plus.toFixed(2)}</td></tr>
                            <tr><td>HR</td><td>${inputPlayer.hr}</td><td>${mostSimilar.hr}</td></tr>
                            <tr><td>PA</td><td>${inputPlayer.pa}</td><td>${mostSimilar.pa}</td></tr>
                        </table>
                    </div>`;
            } else {
                document.getElementById('result').innerHTML = 'No similar players found';
            }
        }
    </script>
</body>
</html>